#!/usr/bin/env php
<?php

// 2024-08-29 jj5 - this script generates the declare.c file that declares all the buttons. You can copy twelve declarations
// from this file into your setup() routine.

require_once __DIR__ . '/inc/common.php';

function main( $argv ) {

  chdir( __DIR__ . '/../../' );

  $spec = file( 'doc/spec.txt' );

  $text = "
// these example declares generated by gen-declare.php

";

  foreach ( $spec as $line ) {

    $line = trim( $line );

    if ( ! $line ) { continue; }

    $parts = explode( ':', $line );

    if ( count( $parts ) !== 2 ) { continue; }

    $code = $parts[ 0 ];

    if ( ! preg_match( '/^[0-9]{4}$/', $code ) ) { continue; }

    $parts = explode( '-' , $parts[ 1 ] );

    $name = trim( $parts[ 1 ] );

    if ( preg_match( '/[^a-zA-Z0-9_]/', $name ) ) {

      var_dump( $name );

      exit;

   }

    $alt_code = str_pad( ltrim( $code, '0' ), 4, ' ', STR_PAD_LEFT );
    $bmp_code = "u{$code}_{$name}";

    $text .= "  declare_button( button_index++, $alt_code, $bmp_code );\n";

  }

  file_put_contents( 'ino/Symbol_Keyboard/gen/declare.c', $text );

}

main( $argv );
